---
name: Renovate third-party licenses

on:
  push:
    branches:
    - renovate/**

permissions:
  contents: write

jobs:
  refresh-third-party-licenses:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v6
    - name: Install uv
      uses: astral-sh/setup-uv@v6
    - name: Set up Python
      run: uv python install
    - name: Regenerate THIRD_PARTY_LICENSES.md
      run: ./.tools/show-third-party-licenses.sh > THIRD_PARTY_LICENSES.md
    - name: Commit updated THIRD_PARTY_LICENSES.md
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

        if git diff --quiet -- THIRD_PARTY_LICENSES.md; then
          echo "No THIRD_PARTY_LICENSES.md changes to commit."
          exit 0
        fi

        git add THIRD_PARTY_LICENSES.md
        git commit -m "chore: refresh THIRD_PARTY_LICENSES.md"
        git push
